version: 2.1

orbs:
  win: circleci/windows@5.0

jobs:
  build-windows:
    executor:
      name: win/default
      size: large
    
    steps:
      - checkout
      
      - run:
          name: Install Node.js
          command: |
            choco install nodejs-lts -y
            refreshenv
      
      - run:
          name: Install pnpm
          command: npm install -g pnpm
      
      - run:
          name: Install dependencies
          command: pnpm install --no-frozen-lockfile
          no_output_timeout: 15m
      
      - run:
          name: Build Next.js (Static Export)
          command: pnpm build
          no_output_timeout: 20m
      
      - run:
          name: Build Electron app
          command: pnpm exec electron-builder --win --x64
          no_output_timeout: 30m
      
      - store_artifacts:
          path: dist-electron
          destination: windows-builds
      
      - persist_to_workspace:
          root: .
          paths:
            - dist-electron

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - build-windows
